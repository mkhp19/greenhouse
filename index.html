<html lang="ja"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æ¥­å‹™WEBã‚¢ãƒ—ãƒªï¼ˆUIãƒ¢ãƒƒã‚¯ v1.1ï¼‰</title>
<style>
  :root{
    --bg:#F5F5F7;
    --card:#FFFFFF;
    --line:#E5E5EA;
    --text:#111;
    --muted:#6C6C70;
    --accent:#007AFF;
    --danger:#FF3B30;
    --success:#34C759;
    --pill:#EFEFF4;
    --shadow:0 2px 6px rgba(0,0,0,.06);
    --radius:12px;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,system-ui,BlinkMacSystemFont,"Hiragino Sans","Hiragino Kaku Gothic ProN","Yu Gothic UI","Segoe UI",sans-serif;font-size:16px;line-height:1.5;}
  .screen{display:none;min-height:100vh;padding-top:56px;padding-bottom:72px;}
  .screen.active{display:block;}
  /* Top bar */
  .topbar{position:fixed;top:0;left:0;right:0;height:56px;background:var(--bg);backdrop-filter:saturate(180%) blur(10px);display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--line);z-index:10;}
  .topbar .title{font-weight:700;}
  .topbar .left,.topbar .right{position:absolute;top:0;height:56px;display:flex;align-items:center;}
  .topbar .left{left:12px;}
  .topbar .right{right:12px;gap:8px;}
  .link{color:var(--accent);text-decoration:none;font-weight:600;}
  .btn{min-height:44px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:var(--card);}
  .btn-primary{background:var(--accent);color:#fff;border-color:var(--accent);}
  .btn-danger{background:var(--danger);color:#fff;border-color:var(--danger);}
  .btn[disabled]{opacity:.4;pointer-events:none;}
  /* Bottom bar */
  .bottombar{position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid var(--line);display:flex;gap:12px;justify-content:flex-end;padding:10px 12px;z-index:10;}
  /* content */
  .container{padding:16px;}
  .section{margin:0 0 24px;}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
  .card .header{padding:8px 16px;color:var(--muted);font-size:13px;border-bottom:1px solid var(--line);}
  .list{display:block;}
  .list-row{display:flex;align-items:center;justify-content:space-between;box-sizing:border-box;padding:12px 16px;min-height:48px;border-bottom:1px solid var(--line);}
  .list-row:last-child{border-bottom:none;}
  .disclosure{color:var(--muted);}
  .field-label{font-size:14px;color:var(--muted);margin:6px 16px 6px;}
  .input, select, textarea{box-sizing:border-box;width:100%;padding:12px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:16px;}
  .input:focus, select:focus, textarea:focus{outline:2px solid rgba(0,122,255,.3);border-color:var(--accent);}
  .row-flex{display:flex;gap:12px;}
  .row-flex .input{flex:1;}
  .pill{display:inline-block;background:var(--pill);padding:6px 10px;border-radius:16px;font-size:14px;}
  .tag{display:inline-block;padding:4px 8px;border-radius:999px;background:#E6F0FF;color:#0451C8;font-size:12px;margin-left:6px;}
  .title-lg{font-size:20px;font-weight:700;margin:6px 0 12px;}
  .muted{color:var(--muted);}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center;}
  .toolbar .grow{flex:1 1 auto;}
  .searchbar{display:flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:8px 12px;}
  .searchbar input{border:none;outline:none;font-size:16px;width:100%;}
  .badge{display:inline-block;border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px;background:#fff;}
  .spacer{height:8px;}
  .hint{font-size:13px;color:var(--muted);margin-top:6px;}
  .grid4{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
  @media(min-width:880px){
    .screen{padding-top:64px;padding-bottom:80px;}
    .container{max-width:880px;margin:0 auto;}
    .grid4{grid-template-columns:repeat(4,1fr);}
  }

  /* flex-direction column fix */
  .list-row[style*="flex-direction:column"] {
    padding-left: 16px !important;
    padding-right: 16px !important;
  }

  /* fix: two-column rows should not overflow */
  .row-flex{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:stretch;}
  .row-flex > *{min-width:0;}
  @media (max-width:380px){
    .row-flex{grid-template-columns:1fr;} /* æ¥µå°ç”»é¢ã§ã‚‚å®‰å…¨ã«1åˆ—åŒ– */
  }
  .row-flex > *{flex:1 1 0;min-width:0;} /* allow shrink */
  input[type="date"]{-webkit-appearance:none;appearance:none;width:100%;max-width:100%;min-width:0;box-sizing:border-box;}
  .input, select, textarea{max-width:100%;min-width:0;}
  .list-row{overflow:hidden;} /* guard against child overflow */

.input-wrap{min-width:0;}

  /* unify control heights (iOS Safari friendly) */
  .input, select, textarea{min-height:48px; line-height:1.3;}
  input[type="date"]{
    -webkit-appearance:none; appearance:none;
    width:100%; max-width:100%; min-width:0; box-sizing:border-box;
    min-height:48px; height:48px; padding:10px 12px; border-radius:10px;
  }
  /* grid row keeps equal heights */
  .row-flex{align-items:stretch;}


  /* ==== Documents list visual differentiation ==== */
  .doc-card{display:flex; align-items:center; gap:12px; padding:12px 16px; min-height:56px; border-bottom:1px solid var(--line); position:relative;}
  .doc-card:last-child{border-bottom:none;}
  .doc-card .icon{font-size:20px; width:24px; text-align:center;}
  .doc-main{flex:1; min-width:0;}
  .doc-title{font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .doc-sub{font-size:13px; color:var(--muted); margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .doc-tag{display:inline-block; font-size:12px; font-weight:700; color:#fff; padding:2px 8px; border-radius:999px; margin-left:8px;}
  .estimate-tag{background:#007AFF;}
  .order-tag{background:#34C759;}
  .invoice-tag{background:#FF3B30;}
  .doc-card.estimate{border-left:4px solid #007AFF; padding-left:12px;}
  .doc-card.order{border-left:4px solid #34C759; padding-left:12px;}
  .doc-card.invoice{border-left:4px solid #FF3B30; padding-left:12px;}
  .doc-right{color:var(--muted);}


  /* pale backgrounds for doc types */
  .doc-card.estimate{ background:#E6F0FF; }
  .doc-card.order{ background:#E8F8E6; }
  .doc-card.invoice{ background:#FFEAEA; }
  /* keep left border visible on colored bg */
  .doc-card.estimate{ border-left-color:#007AFF; }
  .doc-card.order{ border-left-color:#34C759; }
  .doc-card.invoice{ border-left-color:#FF3B30; }


  /* Documents toolbar: single row, no wrap; scroll horizontally if overflow */
  .docs-toolbar{display:flex;align-items:center;gap:2px;flex-wrap:nowrap;overflow-x:auto;white-space:nowrap;}
  .docs-toolbar .btn{flex:0 0 auto;}
  .docs-toolbar select.input{flex:0 0 auto;max-width:70px;font-size:12px;padding:8px 8px;height:44px;min-height:44px;line-height:22px;border-radius:12px;-webkit-appearance:none;appearance:none;}

</style>
</head>
<body>

<!-- Topbar (shared) -->
<div class="topbar">
  <div class="left"><a class="link" href="#" id="backBtn" aria-label="æˆ»ã‚‹" onclick="goBack()" style="display: none;">æˆ»ã‚‹</a></div>
  <div class="title" id="topTitle">æ¥­å‹™ã‚¢ãƒ—ãƒª</div>
  <div class="right"><button class="btn btn-primary" id="saveBtn" disabled="">ä¿å­˜</button></div>
</div>

<!-- Home -->
<section id="home" class="screen active" aria-label="ãƒ›ãƒ¼ãƒ ">
  <div class="container">
    <h1 class="title-lg">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h1>
    <div class="grid4">
      <button class="btn" onclick="showView('product')">å•†å“æ¤œç´¢</button>
      <button class="btn" onclick="showView('customer')">é¡§å®¢ãƒªã‚¹ãƒˆ</button>
      <button class="btn" onclick="showView('vendor')">å–å¼•å…ˆãƒªã‚¹ãƒˆ</button>
      <button class="btn" onclick="showView('docs')">æ›¸é¡ä½œæˆ</button>
      <button class="btn" onclick="showView('settings')">è¨­å®š</button>
    </div>
    <div class="section">
      <div class="card">
        <div class="header">ã¯ã˜ã‚ã¦ã®æ–¹ã¸</div>
        <div class="list">
          <div class="list-row">1. å•†å“ã‚’æ¤œç´¢ã—ã¦è¦‹ç©æ›¸ã«å–ã‚Šè¾¼ã¿</div>
          <div class="list-row">2. è¦‹ç©æ›¸ã‚’ä¿å­˜ â†’ PDF/Excelå‡ºåŠ›</div>
          <div class="list-row">3. ç™ºæ³¨æ›¸/è«‹æ±‚æ›¸ã‚’ä½œæˆ</div>
        </div>
      </div>
    </div>
    <div class="section">
      <button class="btn" onclick="alert('JSONã‚’æ›¸ãå‡ºã™UIæƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">ğŸ—‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆJSONï¼‰</button>
      <button class="btn" onclick="alert('JSONã‚’èª­ã¿è¾¼ã‚€UIæƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">ğŸ“¥ å¾©å…ƒï¼ˆJSONï¼‰</button>
    </div>
  </div>
</section>

<!-- Product Search -->
<section id="product" class="screen" aria-label="å•†å“æ¤œç´¢">
  <div class="container">
    <div class="title-lg">å•†å“æ¤œç´¢</div>
    <div class="toolbar">
      <label class="searchbar grow" aria-label="æ¤œç´¢ãƒãƒ¼">
        ğŸ” <input type="search" id="pQuery" placeholder="å“åãƒ»å“ç•ªã§æ¤œç´¢">
      </label>
      <button class="btn" onclick="showSheet('productForm')">ï¼‹ æ–°è¦ç™»éŒ²</button>
      <span class="badge">æ¡ä»¶: <span id="condText">ï¼ˆæœªæŒ‡å®šï¼‰</span></span>
      <button class="btn" onclick="alert('å•†å“ãƒªã‚¹ãƒˆ.xlsx èª­è¾¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">Excelèª­è¾¼</button>
      <button class="btn" onclick="alert('å•†å“ãƒªã‚¹ãƒˆ.xlsx å‡ºåŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">Excelå‡ºåŠ›</button>
    </div>

    <div class="card section">
      <div class="header">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå“å/å“ç•ª/è¦æ ¼/å‚ç…§æ—¥/è²©å£²å˜ä¾¡ï¼‰</div>
      <div class="list" id="pList">
        <!-- sample rows -->
      <div class="list-row"><div>
      <div><strong>è£œå¼·ãƒ‘ã‚¤ãƒ—</strong> <span class="muted">(HLG-74)</span></div>
      <div class="muted">ç›´å¾„22mm x 1.5mm ãƒ» å‚ç…§æ—¥ 2025/09/01</div>
    </div>
    <div>Â¥1,280 <span class="disclosure">&gt;</span></div></div><div class="list-row"><div>
      <div><strong>å›ºå®šã‚¯ãƒ©ãƒ³ãƒ—</strong> <span class="muted">(CTL2-82)</span></div>
      <div class="muted">25mmç”¨ ãƒ» å‚ç…§æ—¥ 2025/08/20</div>
    </div>
    <div>Â¥350 <span class="disclosure">&gt;</span></div></div><div class="list-row"><div>
      <div><strong>é€æ˜ãƒ•ã‚£ãƒ«ãƒ </strong> <span class="muted">(BPD-64)</span></div>
      <div class="muted">0.1mm x 2m ãƒ» å‚ç…§æ—¥ 2025/07/12</div>
    </div>
    <div>Â¥980 <span class="disclosure">&gt;</span></div></div></div>
    </div>
    <div class="hint">è¡Œã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è¦‹ç©æ˜ç´°ã«å–ã‚Šè¾¼ã‚€æƒ³å®šï¼ˆUIãƒ¢ãƒƒã‚¯ï¼‰ã€‚</div>
  </div>

  <div class="bottombar">
    <button class="btn" onclick="showView('home')">ä¸€è¦§ã¸</button>
    <button class="btn btn-primary" onclick="alert('è¦‹ç©æ›¸ã«å–ã‚Šè¾¼ã‚€ãƒ•ãƒ­ãƒ¼ã®UIãƒ¢ãƒƒã‚¯ã§ã™')">è¦‹ç©æ›¸ã«å–ã‚Šè¾¼ã‚€</button>
  </div>
</section>

<!-- Customer -->
<section id="customer" class="screen" aria-label="é¡§å®¢ãƒªã‚¹ãƒˆ">
  <div class="container">
    <div class="title-lg">é¡§å®¢ãƒªã‚¹ãƒˆ</div>
    <div class="toolbar">
      <label class="searchbar grow">ğŸ” <input type="search" placeholder="é¡§å®¢åãƒ»ä½æ‰€ãƒ»TELãƒ»å‚™è€ƒ"></label>
      <button class="btn" onclick="showSheet('customerForm')">ï¼‹ æ–°è¦ç™»éŒ²</button>
      <select class="input" style="max-width:180px">
        <option>ä»•äº‹å†…å®¹ï¼ˆã™ã¹ã¦ï¼‰</option>
        <option>æ–°ç¯‰</option>
        <option>ä¿®ç¹•</option>
        <option>å¼µæ›¿</option>
      </select>
      <button class="btn" onclick="alert('Excelèª­è¾¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">Excelèª­è¾¼</button>
      <button class="btn" onclick="alert('Excelå‡ºåŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">Excelå‡ºåŠ›</button>
    </div>

    <div class="card">
      <div class="list">
        <div class="list-row">ãƒ•ãƒ«ãƒã‚¦ã‚¹å…ç‰ <span class="disclosure">&gt;</span></div>
        <div class="list-row">æ ªå¼ä¼šç¤¾ã‚°ãƒªãƒ¼ãƒ³ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ <span class="disclosure">&gt;</span></div>
        <div class="list-row">å±±ç”°å¤ªéƒï¼ˆå€‹äººï¼‰ <span class="disclosure">&gt;</span></div>
      </div>
    </div>
  </div>

  <div class="bottombar">
    <button class="btn" onclick="showView('home')">ä¸€è¦§ã¸</button>
  </div>
</section>

<!-- Vendor -->
<section id="vendor" class="screen" aria-label="å–å¼•å…ˆãƒªã‚¹ãƒˆ">
  <div class="container">
    <div class="title-lg">å–å¼•å…ˆãƒªã‚¹ãƒˆ</div>
    <div class="toolbar">
      <label class="searchbar grow">ğŸ” <input type="search" placeholder="ä¼šç¤¾åãƒ»ä½æ‰€ãƒ»TELãƒ»å‚™è€ƒ"></label>
      <button class="btn" onclick="showSheet('vendorForm')">ï¼‹ æ–°è¦ç™»éŒ²</button>
      <button class="btn" onclick="alert('Excelèª­è¾¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">Excelèª­è¾¼</button>
      <button class="btn" onclick="alert('Excelå‡ºåŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æƒ³å®šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">Excelå‡ºåŠ›</button>
    </div>
    <div class="card">
      <div class="list">
        <div class="list-row">æ ªå¼ä¼šç¤¾ãƒ©ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ <span class="disclosure">&gt;</span></div>
        <div class="list-row">æ¾èª¼é‡‘å±å·¥æ¥­ <span class="disclosure">&gt;</span></div>
        <div class="list-row">TOKUI Co., Ltd. <span class="disclosure">&gt;</span></div>
      </div>
    </div>
  </div>
  <div class="bottombar">
    <button class="btn" onclick="showView('home')">ä¸€è¦§ã¸</button>
  </div>
</section>

<!-- Settings -->
<section id="settings" class="screen" aria-label="è¨­å®š">
  <div class="container">
    <div class="title-lg">è¨­å®šï¼ˆè‡ªç¤¾æƒ…å ±ï¼‰</div>
    <div class="card section">
      <div class="header">ä¼šç¤¾æƒ…å ±</div>
      <div class="list-row" style="flex-direction:column;align-items:stretch;gap:8px;">
        <label class="field-label">ç¤¾å</label><input class="input" id="s_name" placeholder="ãƒ•ãƒ«ãƒã‚¦ã‚¹å…ç‰" oninput="markDirty()">
      </div>
      <div class="list-row row-flex">
        <div style="flex:1"><label class="field-label">éƒµä¾¿ç•ªå·</label><input class="input" id="s_zip" placeholder="649-6514" oninput="markDirty()"></div>
        <div style="flex:2"><label class="field-label">ä½æ‰€</label><input class="input" id="s_addr" placeholder="å’Œæ­Œå±±çœŒç´€ã®å·å¸‚è—¤äº•916" oninput="markDirty()"></div>
      </div>
      <div class="list-row row-flex">
        <div style="flex:1"><label class="field-label">ä»£è¡¨å</label><input class="input" id="s_rep" placeholder="å…ç‰å¾ç´€ï¼ˆã“ã ã¾ ã‚‚ã¨ãï¼‰" oninput="markDirty()"></div>
        <div style="flex:1"><label class="field-label">TEL</label><input class="input" id="s_tel" placeholder="0736-73-3038" oninput="markDirty()"></div>
      </div>
      <div class="list-row row-flex">
        <div style="flex:1"><label class="field-label">ç™»éŒ²ç•ªå·</label><input class="input" id="s_tax" placeholder="T4810046688050" oninput="markDirty()"></div>
        <div style="flex:1"><label class="field-label">ãƒ¡ãƒ¼ãƒ«</label><input class="input" id="s_mail" placeholder="info@example.com" oninput="markDirty()"></div>
      </div>
    </div>
    <div class="card section">
      <div class="header">æŒ¯è¾¼å…ˆ</div>
      <div class="list-row row-flex">
        <div style="flex:1"><label class="field-label">éŠ€è¡Œ</label><input class="input" id="b_bank" placeholder="ç´€é™½éŠ€è¡Œ" oninput="markDirty()"></div>
        <div style="flex:1"><label class="field-label">æ”¯åº—</label><input class="input" id="b_branch" placeholder="æ‰“ç”°æ”¯åº—" oninput="markDirty()"></div>
      </div>
      <div class="list-row row-flex">
        <div style="flex:1"><label class="field-label">å£åº§ç¨®åˆ¥</label><input class="input" id="b_type" placeholder="æ™®é€š" oninput="markDirty()"></div>
        <div style="flex:1"><label class="field-label">å£åº§ç•ªå·</label><input class="input" id="b_no" placeholder="336048" oninput="markDirty()"></div>
      </div>
    </div>
    <div class="hint">ä¿å­˜ã™ã‚‹ã¨è«‹æ±‚æ›¸/è¦‹ç©æ›¸ã®è‡ªç¤¾æ¬„ã«åæ˜ ï¼ˆUIãƒ¢ãƒƒã‚¯ï¼‰ã€‚</div>
  </div>
  <div class="bottombar">
    <button class="btn" onclick="showView('home')">ãƒ›ãƒ¼ãƒ ã¸</button>
    <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜</button>
  </div>
</section>

<!-- Documents hub -->
<section id="docs" class="screen" aria-label="æ›¸é¡ä½œæˆ">
  <div class="container">
    <div class="title-lg">æ›¸é¡ä½œæˆ</div>
    <div class="toolbar docs-toolbar">
      <button class="btn" onclick="showView('estimate')">è¦‹ç©æ›¸</button>
      <button class="btn" onclick="showView('purchase')">ç™ºæ³¨æ›¸</button>
      <button class="btn" onclick="showView('invoice')">è«‹æ±‚æ›¸</button>
      <button class="btn" onclick="alert('æ›¸é¡æ¤œç´¢UIï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">ğŸ” æ›¸é¡æ¤œç´¢</button>
      <select class="input" id="docFilter" style="max-width:160px">
        <option>å…¨ã¦</option>
        <option>è¦‹ç©æ›¸</option>
        <option>ç™ºæ³¨æ›¸</option>
        <option>è«‹æ±‚æ›¸</option>
      </select>
    </div>
    <div class="card">
      <div class="header">ä½œæˆæ¸ˆã¿ä¸€è¦§ï¼ˆUIãƒ¢ãƒƒã‚¯ï¼‰</div>
      <div class="list" id="docsList">
        <div class="doc-card estimate">
          <span class="icon">ğŸ“</span>
          <div class="doc-main">
            <div class="doc-title">å±±ç”°å·¥å‹™åº—å¾¡ä¸­_20251006K_1 <span class="doc-tag estimate-tag">è¦‹ç©</span></div>
            <div class="doc-sub">å·¥äº‹åç§°ï¼šå¤–è£…ãƒ•ãƒ¬ãƒ¼ãƒ è£œä¿® ï¼ ä½œæˆæ—¥ï¼š2025/10/06</div>
          </div>
          <span class="disclosure">&gt;</span>
        </div>
        <div class="doc-card order">
          <span class="icon">ğŸ›’</span>
          <div class="doc-main">
            <div class="doc-title">TOKUI_20251004K_1 <span class="doc-tag order-tag">ç™ºæ³¨</span></div>
            <div class="doc-sub">ç´æœŸï¼š2025/10/15 ï¼ åˆè¨ˆï¼šÂ¥120,000ï¼ˆç¨è¾¼ï¼‰</div>
          </div>
          <span class="disclosure">&gt;</span>
        </div>
        <div class="doc-card invoice">
          <span class="icon">ğŸ’°</span>
          <div class="doc-main">
            <div class="doc-title">è«‹æ±‚æ›¸ No.20251012_3 <span class="doc-tag invoice-tag">è«‹æ±‚</span></div>
            <div class="doc-sub">æ”¯æ‰•æœŸé™ï¼š2025/11/10 ï¼ åˆè¨ˆï¼šÂ¥1,200,000ï¼ˆç¨è¾¼ï¼‰</div>
          </div>
          <span class="disclosure">&gt;</span>
        </div>
      </div>
    </div>
  </div>
  <div class="bottombar">
    <button class="btn" onclick="showView('home')">ä¸€è¦§ã¸</button>
    <button class="btn btn-primary" onclick="alert('æ–°è¦ä½œæˆã®å°ç·šï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">ï¼‹ æ–°è¦ä½œæˆ</button>
  </div>
</section>

<!-- Estimate -->
<section id="estimate" class="screen" aria-label="è¦‹ç©æ›¸ä½œæˆ">
  <div class="container">
    <div class="title-lg">è¦‹ç©æ›¸ä½œæˆ</div>
    <div class="section card">
      <div class="header">å®›å…ˆ</div>
      <div class="list">
        <div class="list-row" onclick="selectDemoCustomer()"><span id="estCustomer">é¡§å®¢ï¼ˆå¿…é ˆï¼‰</span><span class="disclosure">&gt;</span></div>
        <div class="list-row"><span>æ•¬ç§°</span><span class="disclosure" id="estKeisho">å¾¡ä¸­</span></div>
      </div>
    </div>
    <div class="section card">
      <div class="header">æ¡ˆä»¶æƒ…å ±</div>
      <div class="list">
        <div class="list-row" style="flex-direction:column;align-items:stretch;gap:8px;">
          <label class="field-label">å·¥äº‹åç§°ï¼ˆå¿…é ˆï¼‰</label>
          <input class="input" id="estTitle" placeholder="ä¾‹ï¼šå¤–è£…ãƒ•ãƒ¬ãƒ¼ãƒ è£œä¿®" oninput="checkRequired()">
        </div>
        <div class="list-row" style="flex-direction:column;align-items:stretch;gap:8px;">
          <label class="field-label">å·¥äº‹å ´æ‰€</label>
          <input class="input" placeholder="ç¾å ´ä½æ‰€ã‚’å…¥åŠ›">
        </div>
        <div class="list-row" style="flex-direction:column;align-items:stretch;gap:8px;">
          <label class="field-label">å·¥äº‹æ¦‚è¦</label>
          <textarea class="input" rows="3" placeholder="æ¦‚è¦â€¦"></textarea>
        </div>
        <div class="list-row row-flex">
          <div style="flex:1">
            <label class="field-label">æ‰€è¦æ—¥æ•°ï¼ˆç›®å®‰ï¼‰</label>
            <input class="input" inputmode="numeric" placeholder="ä¾‹ï¼š3">
          </div>
          <div style="width:120px;align-self:flex-end;margin-bottom:8px;"><span class="pill">æ—¥</span></div>
        </div>
        <div class="list-row row-flex">
          <div class="input-wrap" style="flex:1">
            <label class="field-label">è¦‹ç©æ—¥</label>
            <input class="input" id="estDate" type="date">
          </div>
          <div class="input-wrap" style="flex:1">
            <label class="field-label">æœ‰åŠ¹æœŸé™ï¼ˆå¿…é ˆï¼‰</label>
            <input class="input" id="estDue" type="date" oninput="checkRequired()">
          </div>
        </div>
        <div class="list-row" style="flex-direction:column;align-items:flex-start;gap:6px;">
          <label class="field-label">ç™ºè¡Œç•ªå·ï¼ˆè‡ªå‹•ï¼‰</label>
          <div class="pill" id="estNoPreview" style="font-weight:600;">æœªç¢ºå®šï¼ˆå®›å…ˆã¨æ—¥ä»˜ã§è‡ªå‹•ç”Ÿæˆï¼‰</div>
          <div class="hint">å½¢å¼ï¼šé¡§å®¢å+æ•¬ç§°_YYYYMMDDK_é€£ç•ªï¼ˆä¿å­˜æ™‚ã«ç¢ºå®šï¼‰</div>
        </div>
      </div>
    </div>

    <div class="section card">
      <div class="header">æ˜ç´°ï¼ˆå•†å“ã‹ã‚‰å–ã‚Šè¾¼ã¿ / è¿½åŠ ï¼‰</div>
      <div class="list">
        <div class="list-row" onclick="showView('product')">ï¼‹ å•†å“æ¤œç´¢ã‹ã‚‰å–ã‚Šè¾¼ã‚€ <span class="disclosure">&gt;</span></div>
        <div class="list-row" onclick="alert('ä»»æ„é …ç›®è¿½åŠ UIï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')">ï¼‹ é …ç›®ã‚’è¿½åŠ  <span class="disclosure">&gt;</span></div>
      </div>
      <div class="spacer"></div>
      <div class="list">
        <div class="list-row">åç§°ãƒ»å“å / è¦æ ¼ãƒ»å¯¸æ³• / æ•°é‡ / å˜ä½ / å˜ä¾¡ / é‡‘é¡ / å‚™è€ƒ</div>
        <div class="list-row muted">ï¼ˆã“ã“ã«è¡ŒãŒä¸¦ã¶æƒ³å®šï¼‰</div>
      </div>
      <div class="list-row" style="flex-direction:column;align-items:stretch;gap:8px;">
        <label class="field-label">å€¤å¼•ã</label>
        <input class="input" inputmode="numeric" placeholder="0">
      </div>
      <div class="list-row" style="justify-content:flex-end;gap:16px;">
        <div>å°è¨ˆ Â¥0</div><div>æ¶ˆè²»ç¨(10%) Â¥0</div><div><strong>åˆè¨ˆ Â¥0</strong></div>
      </div>
    </div>

    <div class="hint">PDFã§ã¯æœªå…¥åŠ›é …ç›®ã¯éè¡¨ç¤ºã€Excelã§ã¯ç©ºæ¬„å‡ºåŠ›ï¼ˆUIãƒ¢ãƒƒã‚¯ï¼‰ã€‚</div>
  </div>

  <div class="bottombar">
    <button class="btn" onclick="showView('docs')">ä¸€è¦§ã¸</button>
    <button class="btn" onclick="alert('å˜ä¾¡ç¢ºèªãƒ•ãƒ­ãƒ¼ã®UIãƒ¢ãƒƒã‚¯')">å˜ä¾¡ç¢ºèª</button>
    <button class="btn" onclick="alert('ç™ºæ³¨æ›¸ä½œæˆã¸é·ç§»ã®UIãƒ¢ãƒƒã‚¯')">ç™ºæ³¨æ›¸ä½œæˆ</button>
    <button class="btn btn-primary" onclick="alert('è«‹æ±‚æ›¸ä½œæˆã¸é·ç§»ã®UIãƒ¢ãƒƒã‚¯')">è«‹æ±‚æ›¸ä½œæˆ</button>
    <button class="btn btn-primary" onclick="alert('PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®UIãƒ¢ãƒƒã‚¯')">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
  </div>
</section>

<!-- Purchase Order -->
<section id="purchase" class="screen" aria-label="ç™ºæ³¨æ›¸ä½œæˆ">
  <div class="container">
    <div class="title-lg">ç™ºæ³¨æ›¸ä½œæˆ</div>
    <div class="card section">
      <div class="header">ç™ºæ³¨å…ˆ</div>
      <div class="list">
        <div class="list-row" onclick="alert('ç™ºæ³¨å…ˆé¸æŠUIï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')"><span>ç™ºæ³¨å…ˆï¼ˆå¿…é ˆï¼‰</span><span class="disclosure">&gt;</span></div>
        <div class="list-row"><span>æ”¯æ‰•ã„æ¡ä»¶</span><span class="disclosure">æœˆæœ«ç· ç¿Œæœˆæœ«æ‰• v</span></div>
      </div>
    </div>
    <div class="card section">
      <div class="header">ç´å“</div>
      <div class="list-row row-flex">
        <div style="flex:1">
          <label class="field-label">ç´æœŸ</label>
          <input class="input" type="date">
        </div>
        <div style="flex:1">
          <label class="field-label">ç´å“å ´æ‰€</label>
          <select class="input">
            <option>å’Œæ­Œå±±çœŒç´€ã®å·å¸‚è—¤äº•916</option>
            <option>å’Œæ­Œå±±çœŒç´€ã®å·å¸‚è—¤äº•1-3</option>
            <option>å·¥äº‹å ´æ‰€ï¼ˆè¦‹ç©ã‹ã‚‰ï¼‰</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card section">
      <div class="header">æ˜ç´°</div>
      <div class="list-row">ï¼ˆå“å/å“ç•ª/è¦æ ¼/æ•°é‡/å˜ä½/ä»•å…¥å˜ä¾¡/é‡‘é¡/å‚™è€ƒï¼‰</div>
      <div class="list-row" style="justify-content:flex-end;gap:16px;">
        <div>å°è¨ˆ Â¥0</div><div>æ¶ˆè²»ç¨(10%) Â¥0</div><div><strong>åˆè¨ˆ Â¥0</strong></div>
      </div>
      <div class="list-row">
        <div class="muted">ç¨ç‡åˆ¥å†…è¨³ï¼š10%å¯¾è±¡ ç¨æŠœ Â¥0 / ç¨é¡ Â¥0</div>
      </div>
    </div>
  </div>
  <div class="bottombar">
    <button class="btn" onclick="showView('docs')">ä¸€è¦§ã¸</button>
    <button class="btn btn-primary" onclick="alert('PDFå‡ºåŠ›ã®UIãƒ¢ãƒƒã‚¯')">PDFå‡ºåŠ›</button>
  </div>
</section>

<!-- Invoice -->
<section id="invoice" class="screen" aria-label="è«‹æ±‚æ›¸ä½œæˆ">
  <div class="container">
    <div class="title-lg">è«‹æ±‚æ›¸ä½œæˆ</div>
    <div class="card section">
      <div class="header">å–å¼•å…ˆ</div>
      <div class="list">
        <div class="list-row" onclick="alert('å®›å…ˆé¸æŠUIï¼ˆãƒ€ãƒŸãƒ¼ï¼‰')"><span>å–å¼•å…ˆï¼ˆå¿…é ˆï¼‰</span><span class="disclosure">&gt;</span></div>
        <div class="list-row"><span>æ•¬ç§°</span><span class="disclosure" id="estKeisho">å¾¡ä¸­</span></div>
      </div>
    </div>
    <div class="card section">
      <div class="header">è‡ªç¤¾æƒ…å ± / æŒ¯è¾¼å…ˆ</div>
      <div class="list-row"><span id="invSelf">ãƒ•ãƒ«ãƒã‚¦ã‚¹å…ç‰ / ç´€é™½éŠ€è¡Œ æ‰“ç”°æ”¯åº— æ™®é€š:336048</span></div>
    </div>
    <div class="card section">
      <div class="header">åŸºæœ¬æƒ…å ±</div>
      <div class="list">
        <div class="list-row" style="flex-direction:column;align-items:stretch;gap:8px;">
          <label class="field-label">ä»¶å</label>
          <input class="input" placeholder="ä¾‹ï¼šä¿®ç¹•å·¥äº‹ ä»£é‡‘ã”è«‹æ±‚ã®ä»¶">
        </div>
        <div class="row-flex list-row">
          <div style="flex:1">
            <label class="field-label">è«‹æ±‚æ›¸ç•ªå·ï¼ˆå¿…é ˆï¼‰</label>
            <input class="input" oninput="checkRequired()">
          </div>
          <div style="flex:1">
            <label class="field-label">æç•ª</label>
            <input class="input">
          </div>
        </div>
        <div class="row-flex list-row">
          <div style="flex:1">
            <label class="field-label">è«‹æ±‚æ—¥ï¼ˆå¿…é ˆï¼‰</label>
            <input class="input" type="date" oninput="checkRequired()">
          </div>
          <div style="flex:1">
            <label class="field-label">æ”¯æ‰•æœŸé™</label>
            <input class="input" type="date">
          </div>
        </div>
      </div>
    </div>
    <div class="card section">
      <div class="header">æ˜ç´°</div>
      <div class="list-row">ï¼ˆæ—¥ä»˜/åç§°ãƒ»å“å/è¦æ ¼ãƒ»å¯¸æ³•/æ•°é‡/å˜ä½/å˜ä¾¡/é‡‘é¡/å‚™è€ƒï¼‰</div>
      <div class="list-row" style="justify-content:flex-end;gap:16px;">
        <div>å°è¨ˆ Â¥0</div><div>æ¶ˆè²»ç¨(10%) Â¥0</div><div><strong>åˆè¨ˆ Â¥0</strong></div>
      </div>
      <div class="list-row">
        <div class="muted">ç¨ç‡åˆ¥å†…è¨³ï¼š10%å¯¾è±¡ ç¨æŠœ Â¥0 / ç¨é¡ Â¥0</div>
      </div>
    </div>
  </div>

  <div class="bottombar">
    <button class="btn" onclick="showView('docs')">ä¸€è¦§ã¸</button>
    <button class="btn btn-primary" onclick="alert('PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼UIãƒ¢ãƒƒã‚¯')">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
  </div>
</section>

<!-- Slide-over sheets (mock forms) -->
<dialog id="customerForm" style="border:none;border-radius:16px;max-width:640px;width:92%;">
  <form method="dialog" style="padding:12px;">
    <div class="title-lg">é¡§å®¢ æ–°è¦ç™»éŒ²</div>
    <div class="spacer"></div>
    <label class="field-label">å®›åï¼ˆå¿…é ˆï¼‰</label>
    <input class="input" required="">
    <label class="field-label">éƒµä¾¿ç•ªå·</label>
    <input class="input" id="cust_zip" inputmode="numeric" autocomplete="postal-code" placeholder="6496514">
    <label class="field-label">ä½æ‰€</label>
    <input class="input" id="cust_addr" autocomplete="street-address">
    <label class="field-label">é›»è©±ç•ªå·</label>
    <input class="input" id="cust_tel" inputmode="tel" autocomplete="tel" placeholder="0736733038">
    <label class="field-label">ä»•äº‹å†…å®¹</label>
    <select class="input"><option>æœªé¸æŠ</option><option>æ–°ç¯‰</option><option>ä¿®ç¹•</option><option>å¼µæ›¿</option></select>
    <label class="field-label">ç¾å ´ä½æ‰€ï¼ˆGoogleMapã®URLï¼‰</label>
    <input class="input" inputmode="url" placeholder="https://maps.google.com/â€¦">
    <label class="field-label">å‚™è€ƒ</label>
    <textarea class="input" rows="3"></textarea>
    <div class="spacer"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button class="btn" value="cancel" formnovalidate="">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" value="default">ä¿å­˜</button>
    </div>
  </form>
</dialog>

<dialog id="vendorForm" style="border:none;border-radius:16px;max-width:640px;width:92%;">
  <form method="dialog" style="padding:12px;">
    <div class="title-lg">å–å¼•å…ˆ æ–°è¦ç™»éŒ²</div>
    <div class="spacer"></div>
    <label class="field-label">ä¼šç¤¾åï¼ˆå¿…é ˆï¼‰</label>
    <input class="input" required="">
    <label class="field-label">éƒµä¾¿ç•ªå·</label>
    <input class="input" inputmode="numeric">
    <label class="field-label">ä½æ‰€</label>
    <input class="input" id="cust_addr" autocomplete="street-address">
    <label class="field-label">é›»è©±ç•ªå· / FAX</label>
    <div class="row-flex"><input class="input" inputmode="tel" placeholder="TEL"><input class="input" inputmode="tel" placeholder="FAX"></div>
    <label class="field-label">ãƒ¡ãƒ¼ãƒ« / æ‹…å½“è€… / ç™»éŒ²ç•ªå·</label>
    <div class="row-flex"><input class="input" inputmode="email" placeholder="mail@example.com"><input class="input" placeholder="æ‹…å½“è€…"><input class="input" placeholder="ç™»éŒ²ç•ªå·"></div>
    <label class="field-label">å‚™è€ƒ</label>
    <textarea class="input" rows="3"></textarea>
    <div class="spacer"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button class="btn" value="cancel" formnovalidate="">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" value="default">ä¿å­˜</button>
    </div>
  </form>
</dialog>

<dialog id="productForm" style="border:none;border-radius:16px;max-width:640px;width:92%;">
  <form method="dialog" style="padding:12px;">
    <div class="title-lg">å•†å“ æ–°è¦ç™»éŒ²</div>
    <div class="spacer"></div>
    <label class="field-label">å“åï¼ˆå¿…é ˆï¼‰</label><input class="input" required="">
    <label class="field-label">å“ç•ª</label><input class="input">
    <label class="field-label">è¦æ ¼</label><input class="input">
    <div class="row-flex">
      <div style="flex:1"><label class="field-label">å˜ä½</label><input class="input" placeholder="æœ¬ / å€‹ ãªã©"></div>
      <div style="flex:1"><label class="field-label">æœ€ä½ç™ºæ³¨æ•°é‡</label><input class="input" inputmode="numeric"></div>
    </div>
    <div class="row-flex">
      <div style="flex:1"><label class="field-label">ç™ºæ³¨å…ˆ</label><input class="input" placeholder="å–å¼•å…ˆå"></div>
      <div style="flex:1"><label class="field-label">å‚ç…§æ—¥</label><input class="input" type="date"></div>
    </div>
    <div class="row-flex">
      <div style="flex:1"><label class="field-label">ä»•å…¥å˜ä¾¡</label><input class="input" inputmode="decimal"></div>
      <div style="flex:1"><label class="field-label">è²©å£²å˜ä¾¡</label><input class="input" inputmode="decimal"></div>
    </div>
    <div class="spacer"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button class="btn" value="cancel" formnovalidate="">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" value="default">ä¿å­˜</button>
    </div>
  </form>
</dialog>

<script>
  const historyStack = [];
  const titleMap = {
    home: "æ¥­å‹™ã‚¢ãƒ—ãƒª",
    product: "å•†å“æ¤œç´¢",
    customer: "é¡§å®¢ãƒªã‚¹ãƒˆ",
    vendor: "å–å¼•å…ˆãƒªã‚¹ãƒˆ",
    settings: "è¨­å®š",
    docs: "æ›¸é¡ä½œæˆ",
    estimate: "è¦‹ç©æ›¸ä½œæˆ",
    purchase: "ç™ºæ³¨æ›¸ä½œæˆ",
    invoice: "è«‹æ±‚æ›¸ä½œæˆ"
  };

  function showView(id){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('topTitle').textContent = titleMap[id] || "";
    const backBtn = document.getElementById('backBtn');
    if(id==='home'){ backBtn.style.display='none'; }
    else { backBtn.style.display=''; }
    historyStack.push(id);
    checkRequired();
    if(id==='invoice') refreshInvoiceSelf();

    if(id==='estimate'){
      // set today's date to estDate if empty
      const estDate = document.getElementById('estDate');
      if (estDate && !estDate.value){
        const tzOffset = (new Date()).getTimezoneOffset()*60000;
        const today = new Date(Date.now()-tzOffset).toISOString().slice(0,10);
        estDate.value = today; updateEstimateNoPreview();
      }
    }

  }

  function goBack(){
    historyStack.pop(); // current
    const prev = historyStack.pop() || 'home';
    showView(prev || 'home');
  }

  function showSheet(id){
    const dlg = document.getElementById(id);
    if(!dlg) return;
    dlg.showModal();
  }

  function checkRequired(){
    const active = document.querySelector('.screen.active');
    const saveBtn = document.getElementById('saveBtn');
    let ok = false;
    if(active){
      if(active.id==='estimate'){
        ok = !!document.getElementById('estTitle').value && !!document.getElementById('estDue').value;
      }else if(active.id==='invoice'){
        const req = active.querySelectorAll('input[oninput*="checkRequired"]');
        ok = Array.from(req).every(i=>i.value);
      }else if(active.id==='settings'){
        ok = dirtySettings;
      }
    }
    saveBtn.disabled = !ok;
  }

  // Simple settings store (in-memory for mock)
  let settings = {
    name:"ãƒ•ãƒ«ãƒã‚¦ã‚¹å…ç‰",
    zip:"649-6514",
    addr:"å’Œæ­Œå±±çœŒç´€ã®å·å¸‚è—¤äº•916",
    rep:"å…ç‰å¾ç´€ï¼ˆã“ã ã¾ ã‚‚ã¨ãï¼‰",
    tel:"0736-73-3038",
    tax:"T4810046688050",
    mail:"",
    bank:"ç´€é™½éŠ€è¡Œ",
    branch:"æ‰“ç”°æ”¯åº—",
    btype:"æ™®é€š",
    bno:"336048"
  };
  let dirtySettings = false;
  function markDirty(){ dirtySettings = true; checkRequired(); }
  function saveSettings(){
    settings.name = document.getElementById('s_name').value || settings.name;
    settings.zip = document.getElementById('s_zip').value || settings.zip;
    settings.addr = document.getElementById('s_addr').value || settings.addr;
    settings.rep = document.getElementById('s_rep').value || settings.rep;
    settings.tel = document.getElementById('s_tel').value || settings.tel;
    settings.tax = document.getElementById('s_tax').value || settings.tax;
    settings.mail= document.getElementById('s_mail').value || settings.mail;
    settings.bank= document.getElementById('b_bank').value || settings.bank;
    settings.branch=document.getElementById('b_branch').value || settings.branch;
    settings.btype=document.getElementById('b_type').value || settings.btype;
    settings.bno=document.getElementById('b_no').value || settings.bno;
    dirtySettings = false;
    checkRequired();
    alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆUIãƒ¢ãƒƒã‚¯ï¼‰ã€‚');
    refreshInvoiceSelf();
  }
  function refreshInvoiceSelf(){
    const t = `${settings.name} / ${settings.bank} ${settings.branch} ${settings.btype}:${settings.bno}`;
    const el = document.getElementById('invSelf');
    if(el) el.textContent = t;
  }

  // Populate simple sample list for products
  const sample = [
    {å“å:"è£œå¼·ãƒ‘ã‚¤ãƒ—",å“ç•ª:"HLG-74",è¦æ ¼:"ç›´å¾„22mm x 1.5mm",å‚ç…§æ—¥:"2025/09/01",è²©å£²å˜ä¾¡:"1,280"},
    {å“å:"å›ºå®šã‚¯ãƒ©ãƒ³ãƒ—",å“ç•ª:"CTL2-82",è¦æ ¼:"25mmç”¨",å‚ç…§æ—¥:"2025/08/20",è²©å£²å˜ä¾¡:"350"},
    {å“å:"é€æ˜ãƒ•ã‚£ãƒ«ãƒ ",å“ç•ª:"BPD-64",è¦æ ¼:"0.1mm x 2m",å‚ç…§æ—¥:"2025/07/12",è²©å£²å˜ä¾¡:"980"}
  ];
  const pList = document.getElementById('pList');
  sample.forEach(r=>{
    const row = document.createElement('div');
    row.className='list-row';
    row.innerHTML = `<div>
      <div><strong>${r.å“å}</strong> <span class="muted">(${r.å“ç•ª})</span></div>
      <div class="muted">${r.è¦æ ¼} ãƒ» å‚ç…§æ—¥ ${r.å‚ç…§æ—¥}</div>
    </div>
    <div>Â¥${r.è²©å£²å˜ä¾¡} <span class="disclosure">></span></div>`;
    pList.appendChild(row);
  });

  // default open
  historyStack.push('home');

  // === è¦‹ç©ç•ªå·ã®è‡ªå‹•ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ===
  let selectedCustomerName = ""; // å®›å…ˆåï¼ˆãƒ€ãƒŸãƒ¼é¸æŠï¼‰
  let selectedKeisho = "å¾¡ä¸­";   // æ•¬ç§°
  function selectDemoCustomer(){
    // ãƒ‡ãƒ¢ï¼šé¡§å®¢é¸æŠUIã®ä»£ã‚ã‚Šã«å›ºå®šåã‚’ã‚»ãƒƒãƒˆ
    selectedCustomerName = "å±±ç”°å·¥å‹™åº—";
    document.getElementById('estCustomer').textContent = selectedCustomerName;
    updateEstimateNoPreview();
    alert('é¡§å®¢ã€Œå±±ç”°å·¥å‹™åº—ã€ã‚’é¸æŠã—ã¾ã—ãŸï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ã€‚');
  }
  function updateEstimateNoPreview(){
    const d = document.getElementById('estDate')?.value || "";
    const keisho = document.getElementById('estKeisho')?.textContent || selectedKeisho;
    const preview = document.getElementById('estNoPreview');
    if (!preview) return;
    if (!selectedCustomerName || !d){
      preview.textContent = "æœªç¢ºå®šï¼ˆå®›å…ˆã¨æ—¥ä»˜ã§è‡ªå‹•ç”Ÿæˆï¼‰";
      return;
    }
    const ymd = d.replaceAll('-','');
    const seq = 1; // ãƒ¢ãƒƒã‚¯ã§ã¯å¸¸ã« 1ï¼ˆä¿å­˜æ™‚ã«ç¢ºå®šï¼‰
    preview.textContent = `${selectedCustomerName}${keisho}_${ymd}K_${seq}`;
  }
  // è¦‹ç©æ—¥å¤‰æ›´ã§æ›´æ–°
  (function hookEstDateChange(){
    document.addEventListener('input', (e)=>{
      if (e.target && e.target.id === 'estDate') updateEstimateNoPreview();
    }, true);
  })();


  // === éƒµä¾¿ç•ªå·â†’ä½æ‰€è‡ªå‹•ã€æ•°å€¤åˆ¶é™ã€ãƒã‚¤ãƒ•ãƒ³è‡ªå‹• ===
  (function setupZipTelHelpers(){
    const zip = document.getElementById('cust_zip');
    const addr = document.getElementById('cust_addr');
    const tel = document.getElementById('cust_tel');

    // æ•°å€¤ã®ã¿ï¼†éƒµä¾¿ç•ªå·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ XXX-XXXXï¼ˆå…¥åŠ›é€”ä¸­ã‚‚è‡ªç„¶ã«ï¼‰
    let lastZipFetched = '';
    function formatZipProgressive(raw){
      const d = raw.replace(/[^0-9]/g, '').slice(0,7);
      if (d.length <= 3) return d;
      return d.slice(0,3) + '-' + d.slice(3);
    }
    async function fetchAddressIfReady(rawDigits){
      if (rawDigits.length !== 7) return;
      if (lastZipFetched === rawDigits) return;
      lastZipFetched = rawDigits;
      try{
        const res = await fetch('https://zipcloud.ibsnet.co.jp/api/search?zipcode=' + rawDigits);
        const data = await res.json();
        if (data && data.results && data.results[0] && addr){
          const r = data.results[0];
          addr.value = (r.address1||'') + (r.address2||'') + (r.address3||'');
        }
      }catch(e){
        console.warn('zipcloud failed', e);
      }
    }

    if (zip){
      zip.addEventListener('input', (e)=>{
        const raw = e.target.value;
        const digits = raw.replace(/[^0-9]/g,'');
        e.target.value = formatZipProgressive(digits);
        // 7æ¡ãã‚ã£ãŸã‚‰ä½æ‰€æ¤œç´¢
        fetchAddressIfReady(digits);
      });
      zip.addEventListener('blur', (e)=>{
        const digits = e.target.value.replace(/[^0-9]/g,'');
        e.target.value = formatZipProgressive(digits);
        fetchAddressIfReady(digits);
      });
    }

    // é›»è©±ç•ªå·ï¼šæ•°å­—ã®ã¿ + ãƒã‚¤ãƒ•ãƒ³è‡ªå‹•ï¼ˆç°¡æ˜“ï¼š080/090/070/050/0120ã¯3-4-4ã€11æ¡ã‚‚3-4-4ã€10æ¡ã¯2-4-4ï¼‰
    function formatTel(raw){
      const d = raw.replace(/[^0-9]/g,'').slice(0,11);
      if (d.length <= 3) return d;
      const mobilePrefixes = /^(070|080|090|050|0120)/;
      if (d.length === 11) return d.slice(0,3) + '-' + d.slice(3,7) + '-' + d.slice(7);
      if (d.length === 10){
        if (mobilePrefixes.test(d)) return d.slice(0,3) + '-' + d.slice(3,6) + '-' + d.slice(6);
        // åœ°æ–¹å±€ç•ªæƒ³å®šï¼š2-4-4ï¼ˆâ€»ç°¡æ˜“ï¼‰
        return d.slice(0,2) + '-' + d.slice(2,6) + '-' + d.slice(6);
      }
      // é€”ä¸­å…¥åŠ›æ™‚ã®è‡ªç„¶ãªåŒºåˆ‡ã‚Šï¼ˆ3-4-æ®‹ã‚Šï¼‰
      if (d.length > 7) return d.slice(0,3) + '-' + d.slice(3,7) + '-' + d.slice(7);
      if (d.length > 3) return d.slice(0,3) + '-' + d.slice(3);
      return d;
    }

    if (tel){
      tel.addEventListener('input', (e)=>{
        e.target.value = formatTel(e.target.value);
      });
      tel.addEventListener('blur', (e)=>{
        e.target.value = formatTel(e.target.value);
      });
    }
  })();

</script>


</body></html>